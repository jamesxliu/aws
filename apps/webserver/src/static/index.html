<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        * {
            font-family: sans-serif;
            font-size: 14px;
        }

        form {
            padding: 20px;
            background: #ccc;
        }

        form {
            font-size: 16px;
        }

        form label {
            display: block;
            margin-bottom: 15px;
            font-weight: bold;
        }

        form label input,
        form label select,
        form label textarea {
            display: block;
            margin-top: 5px;
        }

        .ui-logs {
            width: 100%;
            padding: 10px 0;
        }

        .ui-logs textarea {
            min-height: 300px;
        }

        .submit {
            margin-top: 20px;
            background-color: deepskyblue;
            color: white;
            border: none;
            padding: 8px 14px;
            font-size: 20px;
            cursor: pointer;
        }

        .submit:hover {
            background-color: dodgerblue;
        }
    </style>
</head>
<body>
<div>
<p>
    This is a quick & dirty image transformation app leveraging an open source
    core: <a href="https://github.com/fogleman/primitive">https://github.com/fogleman/primitive</a>
</p>
<ol>
    <li>Upload image</li>
    <li>Wait 0.5 - 2+ minutes depending on settings</li>
    <li>Server will redirect to results when done.</li>
</ol>
</div>
<form class="uploadForm"
      method='post'
      action='upload'
      enctype="multipart/form-data">
    <label>
        Image (jpg, jpeg, png, svg)
        <input type='file' name='fileUploaded'/>
    </label>

    <label>
        Precision (50 - 200)
        <input type='number' name='n' value="100"/>
    </label>
    <label>
        Mode
        <select name="m">
            <option value="0" selected>Combo (Default)</option>
            <option value="1">Triangle</option>
            <option value="2">Rectangle</option>
            <option value="3">Ellipse</option>
            <option value="4">Circle</option>
            <option value="5">Rotated Rectangle</option>
            <option value="6">Beziers</option>
            <option value="7">Rotated Ellipse</option>
            <option value="8">Polygon</option>
        </select>
    </label>
    <label>
        Repeats (refinement - drastically slows down rendering)
        <input type="number" name="rep" value="0"/>
    </label>
    <label>
        Resize input
        <input type="number" name="r" value="256"/>
    </label>
    <label>
        Output Size
        <input type="number" name="s" value="1024"/>
    </label>
    <label>
        Color Alpha (0 to let algorithm decide)
        <input type="number" name="a" value="128"/>
    </label>
    <hr/>
    <p>
        <strong>Verbose Logging</strong>
    </p>
    <p>
        Logs command line output (STDOUT) to dev console.
    </p>
    <label>
        Enabled
        <input class="v" type="checkbox" name="v"/>
    </label>
    <label>
        High Granularity (more logs, more lag)
        <input class="vv" type="checkbox" name="vv"/>
    </label>
    <label>
        Show below instead (even more lag)
        <input class="ui-logs-trigger" type="checkbox"/>
    </label>
    <div class="ui-logs">
        <label>
            Logs
            <textarea readonly cols="56" style="font-family:monospace"></textarea>
        </label>
    </div>
    <hr/>
    <input type='submit' class="submit"/>
</form>
</body>
<script src="js/jquery-3.2.1.min.js" type="text/javascript"></script>
<script type="text/javascript">
    (function($){
        var uiLogs = false;
        var uiLogsWindow = $('.ui-logs textarea').val('')[0];
        var outputPath;

        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function() {//Call a function when the state changes.
            if(xhr.readyState == XMLHttpRequest.DONE && xhr.status == 200) {
                var outputCaptureRegex = new RegExp(".+(\/.+\.[a-z A-Z]{3,4})", "i");
                outputPath = this.responseText.match(outputCaptureRegex)[1];
                window.open('/output'.concat(outputPath), '_blank');
                console.log('Done: ', this);
            }
        };
        xhr.onprogress = function(e) {
            if(uiLogs) {
                uiLogsWindow.value += this.response;
                uiLogsWindow.scrollTop = uiLogsWindow.scrollHeight - uiLogsWindow.clientHeight;
            } else {
                console.log(this.response);
            }
        };

        $('.ui-logs-trigger').click(function(e) {
            uiLogs = $(this).prop('checked');
            console.log('Checked', uiLogs);
        });

        $('.v').click(function() {
            $('.vv').attr('name', ($(this).prop('checked') ? null : 'vv'));
        });

        $('.vv').click(function(){
            $('.v').attr('name', ($(this).prop('checked') ? null : 'v'));
            $(this)[0].name = 'vv';
        });

        $('.uploadForm').submit(function(e){
            e.preventDefault();
            xhr.open('POST', '/upload', true);
            xhr.send(new FormData(this));

            return false;
        })
    })(jQuery)
</script>
</html>